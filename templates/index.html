<!DOCTYPE html>
<html>
<head>
    <title>Upload Picture</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
          margin: 0;
          padding: 0;
          overflow: hidden;
        }
    
        #plotly-container {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: #000000; /* Dark background color */
        }
        
        #plotly-graph-div js-plotly-plot {
            height: 100%;
        }

        #imageContainer {
        position: fixed;
        bottom: 0;
        right: 0;
        width: 30%;
        max-width: 200px; /* Optional: Add a max-width to limit the container's width */
        overflow: hidden; /* Clip the image if it exceeds the container's boundaries */
        }

        #imageContainer img {
            width: 100%; /* Make the image fill the container's width */
            height: auto; /* Maintain the image's aspect ratio */
            object-fit: contain; /* Scale the image to fit while preserving aspect ratio */
        }

        #upload-field {
          position: absolute;
          top: 20px;
          left: 20px;
          width: 250px;
          height: 100px;
          border-radius: 10px;
          background-color: rgba(255,255,255,0.7); /* Semi-transparent white background */
        }
        
        #upload-field p {
            text-align:center; 
            color:#000000; /* Text color */
        }

      </style>
</head>
<body>
    <h1>Upload a Picture</h1>

    <div id="plotly-container">
        {{ plot|safe }}
    </div>
    
    <div id="upload-field" ondrop="handleDrop(event)" ondragover="handleDragOver(event)">
        <p>Drag and drop a picture here.</p>
    </div>

    <div id="imageContainer">
        <img src="data:image/jpeg;base64,{{ img_base64 }}" alt="Uploaded Image">
    </div>

    <script>
        function handleDrop(e) {
            e.preventDefault();
            var file = e.dataTransfer.files[0];
            uploadFile(file);
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function uploadFile(file) {
            var formData = new FormData();
            formData.append('file', file);

            fetch('/', {
                method: 'POST',
                body: formData
            }).then(function(response) {
                return response.text();
            }).then(function(html) {
                document.body.innerHTML = html;

                // Rerun all scripts after exchanging the body
                var tempContainer = document.createElement('div');
                tempContainer.innerHTML = html;
                // Extract all script elements from the temporary container
                var scripts = tempContainer.querySelectorAll('script');
                // Create and append new script elements to execute them
                scripts.forEach(function(script) {
                    var newScript = document.createElement('script');
                    Array.from(script.attributes).forEach(function(attr) {
                    newScript.setAttribute(attr.name, attr.value);
                    });
                    newScript.appendChild(document.createTextNode(script.innerHTML));
                    document.head.appendChild(newScript); // Or use document.body if necessary
                });
            });
        }
    </script>



</body>
</html>